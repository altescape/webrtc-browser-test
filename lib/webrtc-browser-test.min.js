"use strict";!function(){var e=function(e,t){var r=new Error(t);return r.name=e,r},t=function(t){if("string"==typeof t.mediaElementContainer&&(t.mediaElementContainer=document.querySelector(t.mediaElementContainer)),!t.mediaElementContainer)throw e("ParameterError","Missing required element parameter");if(!t.onVolumeChange)throw e("ParameterError","Missing required volume callback parameter");var r=document.querySelector("#videoContainer > video");r||(r=document.createElement("video"),r.setAttribute("autoplay",!0),t.mediaElementContainer.appendChild(r));var n=document.querySelector("#videoContainer > audio");n||(n=document.createElement("audio"),n.setAttribute("autoplay",!0),t.mediaElementContainer.appendChild(n));var o=function(e){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e):navigator.getUserMedia?new Promise(function(t,r){navigator.getUserMedia(e,t,r)}):navigator.mozGetUserMedia?new Promise(function(t,r){navigator.mozGetUserMedia(e,t,r)}):navigator.webkitGetUserMedia?new Promise(function(t,r){navigator.webkitGetUserMedia(e,t,r)}):void 0},i=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia?Promise.resolve():Promise.reject(e("BrowserNotSupported","Your browser doesn't support WebRTC."))},a=function(e,t){var r=e.createScriptProcessor(2048,1,1);r.connect(e.destination);var n=null;return r.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),o=0,i=0;o<r.length;)i+=Math.abs(r[o++]);var a=Math.sqrt(i/r.length);n=null===n||n<a?a:.7*n+.3*a;var u=Math.log(n)/Math.LN10/1.5+1;u=Math.min(Math.max(u,0),1),t&&t(u)},r},u=function(r){var n=void 0;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext}catch(t){return Promise.reject(e("BrowserNotSupported","Your browser doesn't support web audio."))}var o=a(n,t.onVolumeChange);try{return n.createMediaStreamSource(r).connect(o),Promise.resolve()}catch(e){return Promise.reject(e)}};return{checkBrowser:i,startVideo:function(){return i().then(function(){return o({video:!0}).then(function(e){return r.srcObject=e,Promise.resolve()})})},startAudio:function(){return i().then(function(){return o({audio:!0}).then(function(e){return n.srcObject=e,u(e)})})}}};"undefined"==typeof module||void 0===module.exports?window.WebRtcBrowserTest=t:module.exports=t}();
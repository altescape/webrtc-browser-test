"use strict";!function(){var u=function(e){this.name="ParameterError",this.message=e||""};u.prototype=Error.prototype;var c=function(e){this.name="BrowserNotSupportedError",this.message=e||""};c.prototype=Error.prototype;var d=function(e){this.name="VideoNotFoundError",this.message=e||"Unable to detect a video camera. Please ensure you've installed and tested your webcam."};d.prototype=Error.prototype;var m=function(e){this.name="VideoDeniedError",this.message=e||"Your browser is preventing access to your camera and microphone. Please check your browser settings (usually an icon in the address bar) to enable access."};m.prototype=Error.prototype;var l=function(e){this.name="AudioNotFoundError",this.message=e||"Unable to detect a microphone. Usually your video camera will have an integrated microphone, but if not please attach and enable one."};l.prototype=Error.prototype;var p=function(e){this.name="AudioDeniedError",this.message=e||"Your browser is preventing access to your microphone. Please check your browser settings (usually an icon in the address bar) to enable access."};p.prototype=Error.prototype;var e=function(o){if("string"==typeof o.mediaElementContainer&&(o.mediaElementContainer=document.querySelector(o.mediaElementContainer)),!(o.mediaElementContainer&&o.mediaElementContainer instanceof Element))throw new u("Missing required element parameter. Tests can't continue.");if(o.onVolumeChange&&"function"!=typeof o.onVolumeChange)throw new u("Volume callback parameter must be a function. Tests can't continue.");if(!window.Promise)throw new c("Your browser doesn't support Promises. Tests can't continue.");var t=document.querySelector("#videoContainer > video");t||((t=document.createElement("video")).setAttribute("autoplay",!0),o.mediaElementContainer.appendChild(t));var r=document.querySelector("#videoContainer > audio");r||((r=document.createElement("audio")).setAttribute("autoplay",!0),o.mediaElementContainer.appendChild(r));var e=function(r){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(r):navigator.getUserMedia?new Promise(function(e,t){navigator.getUserMedia(r,e,t)}):navigator.mozGetUserMedia?new Promise(function(e,t){navigator.mozGetUserMedia(r,e,t)}):navigator.webkitGetUserMedia?new Promise(function(e,t){navigator.webkitGetUserMedia(r,e,t)}):void 0},n=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia?Promise.resolve():Promise.reject(new c("Your browser doesn't support WebRTC."))},a=function(){return n().then(function(){return e({video:!0}).then(function(e){return t.srcObject=e,Promise.resolve()}).catch(function(e){throw"NotFoundError"===e.name?new d:"NotAllowedError"===e.name?new m:"PermissionDeniedError"===e.name?new m:e})})},i=function(){return n().then(function(){return e({audio:!0}).then(function(e){return r.srcObject=e,r.muted=!0,s(e)}).catch(function(e){throw"NotFoundError"===e.name?new l:"NotAllowedError"===e.name?new p:"PermissionDeniedError"===e.name?new p:e})})},s=function(e){var t=void 0;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,t=new AudioContext}catch(e){return Promise.reject(new c("Your browser doesn't support web audio."))}var r=function(e,i){var t=e.createScriptProcessor(2048,1,1);t.connect(e.destination);var s=null;return t.onaudioprocess=function(e){for(var t=e.inputBuffer.getChannelData(0),r=0,o=0;r<t.length;)o+=Math.abs(t[r++]);var n=Math.sqrt(o/t.length);s=null===s||s<n?n:.7*s+.3*n;var a=Math.log(s)/Math.LN10/1.5+1;a=Math.min(Math.max(a,0),1),i&&i(a)},t}(t,o.onVolumeChange);try{return t.createMediaStreamSource(e).connect(r),Promise.resolve()}catch(e){return Promise.reject(e)}};return{checkBrowser:n,startVideo:a,startAudio:i,startAll:function(){return n().then(function(){return a()}).then(function(){return i()})}}};"undefined"==typeof module||void 0===module.exports?window.WebRtcBrowserTest=e:module.exports=e}();
